# Title shown in Application Information tab.
title: UiPath Robot
# Sub Title shown in Application Information tab.
description: UiPath Robot Terraform Deployment
schemaVersion: 1.1.0
version: "20190304"

# URL of Logo Icon used on Application Information tab. Logo must be 130x130 pixels.
# (Optional)
logoUrl: https://cloudmarketplace.oracle.com/marketplace/content?contentId=72870198

# Used in Application Information tab to Hyperlink Title and Logo to the Marketplace
# Listing.
# Also used to link to Listing Usage section for "View Instructions".
# (Optional) If it is missing, Application Information uses the
# "marketplace-listing-id" tag for the same purpose.
source:
  type: marketplace
  reference: 72858089

locale: "en"
variableGroups:
  - title: "Hidden Variable Group"
    visible: false
    variables:
      - tenancy_ocid
      - mp_listing_id
      - mp_listing_resource_id
      - mp_listing_resource_version
      - region
      - compartment_ocid
      - use_marketplace_image

  - title: "Basics"
    variables:
      - vm_display_name
      - instance_username
      - instance_password
      - instance_count

  - title: "Orchestrator Connection Info"
    variables:
      - orchestrator_url
      - is_orchestrator_dns_resolvable
      - orchestratorIP
      - orchestratorHostname
      - orchestrator_admin
      - orchestrator_adminpw
      - orchestrator_tennant
      - robot_type
      - robot_version
      - is_orchestrator_certificate_trusted
      - orchCertificateBase64
      - orchCertificatePass

  - title: "Virtual Machine Settings"
    variables:
      - vm_compute_shape
      - availability_domain_name

  - title: "Network Settings"
    variables:
      - network_strategy
      - vcn_id
      - vcn_display_name
      - vcn_cidr_block
      - vcn_dns_label
      - subnet_dns_label
      # - subnet_type
      - subnet_id
      - subnet_display_name
      - subnet_cidr_block
      - nsg_display_name
      - nsg_whitelist_ip

variables:
  # Hidden variables
  tenancy_ocid:
    type: string
    title: Tenancy ID
    description: The Oracle Cloud Identifier (OCID) for your tenancy
    required: true

  mp_listing_id:
    type: string
    required: false
    description: Marketplace Listing ID

  mp_listing_resource_id:
    type: oci:core:image:id
    required: true
    description: Marketplace Image OCID
    dependsOn:
      compartmentId: compartment_ocid

  mp_listing_resource_version:
    type: string
    required: false
    description: Marketplace Listing package version

  region:
    type: oci:identity:region:name
    title: Region
    description: The region in which to create all resources
    required: true

  compartment_ocid:
    type: oci:identity:compartment:id
    required: true
    title: Compartment
    description: The compartment in which to create all resources

  #Basics variables
  vm_display_name:
    type: string
    required: true
    default: "robot"
    title: Instance Name
    description: Display name/hostname of the instance, number appended based on instance count.

  instance_username:
    type: string
    required: true
    default: "opc"
    minLength: 3
    maxLength: 255
    title: Username
    description: Admin username for the machine. If using 'opc' the autogenerated password will be reset to the value below.

  instance_password:
    type: password
    required: true
    title: Password
    pattern: "^(?:(?=.*[a-z])(?:(?=.*[A-Z])(?=.*[\\d\\W])|(?=.*\\W)(?=.*\\d))|(?=.*\\W)(?=.*[A-Z])(?=.*\\d)).{12,}$"
    description: Password for admin user. 12 characters, contains 3 of lower case, uppercase, number, symbol

  instance_count:
    type: integer
    required: true
    title: Number of virtual machines with Robots to be created
    description: Number of Robots to be created in existing Orchestrator.
    minimum: 1

  #Orchestrator Connection Info variables
  orchestrator_url:
    type: link
    required: true
    title: The URL of an existing and licensed Orchestrator
    description: Orchestrator URL. E.g http://orchestrator.com.

  is_orchestrator_dns_resolvable:
    type: enum
    title: Is your Orchestrator DNS resolvable by a DNS Server ?
    description: The FQDN of your Orchestrator needs to be translated to an IP address. If the Robot machine cannot translated the FQDN of your Orchestrator, please select "No". Otherwise select "Yes"
    required: true
    default: "Yes"
    enum:
      - "Yes"
      - "No"

  orchestratorIP:
    type: string
    required: true
    title: Orchestrator IP address
    description: The Orchestrator public IP address. It will be added to your hosts file in order for Robot to be able to connect to it.
    visible:
      eq:
        - is_orchestrator_dns_resolvable
        - "No"
  
  orchestratorHostname:
    type: string
    required: true
    title: Orchestrator hostname
    description: Orchestrator's hostname. It will be mapped to the Orchestrator IP address in your hosts file in order for Robot to be able to connect to it.
    visible:
      eq:
        - is_orchestrator_dns_resolvable
        - "No"

  orchestrator_admin:
    type: string
    required: true
    title: Orchestrator admin account
    description: Orchestrator admin account with API rights

  orchestrator_adminpw:
    type: password
    required: true
    title: Orchestrator admin's password
    description: The admin's password

  orchestrator_tennant:
    type: string
    required: true
    title: Orchestrator Tenant Name
    description: Orchestrator Tenant Name
    default: default

  robot_type:
    type: enum
    required: true
    title: Robot Type
    description: "Robot Type to be installed. Available types: Development, Attended, Unattended, NonProduction"
    default: "Development"
    enum:
      - "Attended"
      - "Unattended"
      - "Development"
      - "NonProduction"

  robot_version:
    type: enum
    title: UiPath Robot version
    description: The version of UiPath Robot to be installed.
    required: true
    default: "20.4.3"
    enum:
      - "20.4.3"
      - "19.10.5"
      - "19.4.6"
      - "18.4.8"

  is_orchestrator_certificate_trusted:
    type: enum
    title: Is the Orchestrator SSL certificate trusted by the Robot machine ?
    description: In order to connect the Robot to Orchestrator, the SSL certificate used by Orchestrator needs to be in the Trusted Root Store of the Robot machine. If the Orchestrator uses a trusted certificate issued by a Certificate Authority, select "YES". Otherwise select "NO"
    required: true
    default: "Yes"
    enum:
      - "Yes"
      - "No"

  orchCertificateBase64:
    type: string
    required: true
    title: SSL certificate (base64)
    description: Orchestrator's SSL certificate, which will be installed in the Trusted Root store on the Robot machine.
    visible:
      eq:
        - is_orchestrator_certificate_trusted
        - "No"

  orchCertificatePass:
    type: password
    required: false
    title: SSL certificate password
    description: The password used to secure your PFX certificate
    visible:
      eq:
        - is_orchestrator_certificate_trusted
        - "No"

  #Virtual Machine Settings variables
  availability_domain_name:
    type: oci:identity:availabilitydomain:name
    dependsOn:
      compartmentId: compartment_ocid
    required: true
    title: Availability Domain
    description: Availability Domain

  vm_compute_shape:
    type: oci:core:instanceshape:name
    title: Compute Shape
    required: true
    default: "VM.Standard2.4"
    dependsOn:
      compartmentId: compartment_ocid
      imageId: mp_listing_resource_id

  network_strategy:
    type: enum
    title: Network Strategy
    description: Create or use existing Network Stack (VCN and Subnet)
    default: "Create New VCN and Subnet"
    enum:
      - "Create New VCN and Subnet"
      - "Use Existing VCN and Subnet"
    required: true

  # subnet_type:
  #   visible: #($network_strategy  == ""Create New VCN and Subnet"")
  #     eq:
  #       - network_strategy
  #       - Create New VCN and Subnet
  #   type: enum
  #   title: Subnet Type
  #   description: Choose between private and public subnets
  #   enum:
  #   - "Private Subnet"
  #   - "Public Subnet"
  #   required: false

  vcn_display_name:
    visible: #($network_strategy  == ""Create New VCN and Subnet"")
      eq:
        - network_strategy
        - Create New VCN and Subnet
    type: string
    required: true
    default: "uipath"
    title: Virtual Cloud Network (VCN)
    description: The name of the new Virtual Cloud Network (VCN)

  vcn_id:
    visible: #($network_strategy  == "Use Existing VCN and Subnet")
      eq:
        - network_strategy
        - Use Existing VCN and Subnet
    type: oci:core:vcn:id
    dependsOn:
      compartmentId: compartment_ocid
    required: true
    default: ''
    title: Existing Network
    description: An existing Virtual Cloud Network (VCN) in which to create the compute instances, network resources, and load balancers. If not specified, a new VCN is created.

  vcn_cidr_block:
    visible: #($network_strategy  == ""Create New VCN and Subnet"")
      eq:
        - network_strategy
        - Create New VCN and Subnet
    type: string
    required: true
    default: "10.0.0.0/16"
    pattern: "^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\\/(3[0-2]|[1-2]?[0-9])$"
    title: VCN CIDR BLOCK
    description: The CIDR of the new Virtual Cloud Network (VCN). If you plan to peer this VCN with another VCN, the VCNs must not have overlapping CIDRs.

  subnet_display_name:
    visible: #($network_strategy  == ""Create New VCN and Subnet"")
      eq:
        - network_strategy
        - Create New VCN and Subnet
    type: string
    default: "subnet"
    required: false
    title: Subnet
    description: The name of the new Subnet

  subnet_cidr_block:
    visible: #($network_strategy  == ""Create New VCN and Subnet"")
      eq:
        - network_strategy
        - Create New VCN and Subnet
    type: string
    default: "10.0.0.0/24"
    pattern: "^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\\/(3[0-2]|[1-2]?[0-9])$"
    required: false
    title: Subnet CIDR
    description: The CIDR of the new Subnet. The new subnet's CIDR should not overlap with any other subnet CIDRs.

  subnet_id:
    visible: #($network_strategy  == "Use Existing VCN and Subnet")
      eq:
        - network_strategy
        - Use Existing VCN and Subnet
    type: oci:core:subnet:id
    dependsOn:
      vcnId: vcn_id
      compartmentId: compartment_ocid
    required: true
    default: ''
    title: Existing Subnet
    description: An existing subnet to use for compute instances. This subnet must already be present in the chosen VCN.

  subnet_dns_label:
    visible: #($network_strategy  == ""Create New VCN and Subnet"")
      eq:
        - network_strategy
        - Create New VCN and Subnet
    type: string
    required: true
    maxLength: 15
    default: "subnet"
    title: Subnet DNS Label
    description: Subnet DNS Label. Only letters and numbers, starting with a letter. 15 characters max.

  vcn_dns_label:
    visible: #($network_strategy  == ""Create New VCN and Subnet"")
      eq:
        - network_strategy
        - Create New VCN and Subnet
    type: string
    default: "uipath"
    required: true
    maxLength: 15
    title: VCN DNS Label
    description: VCN DNS Label. Only letters and numbers, starting with a letter. 15 characters max.

  nsg_display_name:
    type: string
    required: true
    default: my-network-security-group
    title: Network Security Group
    description: The name of the Network Security Group

  nsg_whitelist_ip:
    type: string
    required: true
    default: 0.0.0.0/0
    title: Network Security Groups - Whitelisted IP
    description: "Ingress connection to VM whitelisted from IP (range). Enter 0.0.0.0/0 or <your IP>/32"

outputGroups:
  - title: "Output"
    outputs:
      - instance_public_ip
      - instance_id

outputs:
  application_url:
    type: link
    title: Go to Application VM URL
    visible: false

  instance_public_ip:
    type: link
    title: Public IP
    visible: true

  instance_private_ip:
    type: link
    title: Private IP
    visible: true

primaryOutputButton: application_url
