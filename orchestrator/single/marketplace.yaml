# Title shown in Application Information tab.
title: UiPath Orchestrator
# Sub Title shown in Application Information tab.
description: UiPath Orchestrator Terraform Deployment
schemaVersion: 1.3.0
version: "20200807"

# URL of Logo Icon used on Application Information tab. Logo must be 130x130 pixels.
# (Optional)
logoUrl: https://cloudmarketplace.oracle.com/marketplace/content?contentId=72870198

# Used in Application Information tab to Hyperlink Title and Logo to the Marketplace
# Listing.
# Also used to link to Listing Usage section for "View Instructions".
# (Optional) If it is missing, Application Information uses the
# "marketplace-listing-id" tag for the same purpose.
source:
  type: marketplace
  reference: 75745470

locale: "en"
variableGroups:
  - title: "Hidden Variable Group"
    visible: false
    variables:
      - tenancy_ocid
      - mp_listing_id
      - mp_listing_resource_id
      - mp_listing_resource_version
      - region
      - compartment_ocid
      - use_marketplace_image
      - marketplace_source_images

  - title: "Basics"
    variables:
      - vm_display_name
      - instance_username
      - instance_password

  - title: "Orchestrator Info"
    variables:
      - orchestratorVersion
      - orchestratorAdminPassword
      - passphrase
      - certificateBase64
      - certificatePass
      - ISCertificateBase64
      - ISCertificatePass


  - title: "Virtual Machine Settings"
    variables:
      - vm_compute_shape
      - availability_domain_name

  - title: "SQL Settings"
    variables:
      - databaseType
      - databaseServerName
      - databaseName
      - databaseUserName
      - databaseUserPassword
      - mssql_sa_password
      - ssh_public_key

  - title: "Network Settings"
    variables:
      - network_strategy
      - vcn_id
      - vcn_display_name
      - vcn_cidr_block
      - vcn_dns_label
      - subnet_dns_label
      # - subnet_type
      - subnet_id
      - subnet_display_name
      - subnet_cidr_block
      - nsg_display_name
      - nsg_whitelist_ip

variables:
  # Hidden variables
  tenancy_ocid:
    type: string
    title: Tenancy ID
    description: The Oracle Cloud Identifier (OCID) for your tenancy
    required: true

  mp_listing_id:
    type: string
    required: false
    description: Marketplace Listing ID

  mp_listing_resource_id:
    type: oci:core:image:id
    required: true
    description: Marketplace Image OCID
    dependsOn:
      compartmentId: compartment_ocid

  mp_listing_resource_version:
    type: string
    required: false
    description: Marketplace Listing package version

  region:
    type: oci:identity:region:name
    title: Region
    description: The region in which to create all resources
    required: true

  compartment_ocid:
    type: oci:identity:compartment:id
    required: true
    title: Compartment
    description: The compartment in which to create all resources

  #Basics variables
  vm_display_name:
    type: string
    required: true
    default: "orchestrator"
    title: Instance Name
    description: Display name/hostname of the instance.

  instance_username:
    type: string
    required: true
    default: "opc"
    minLength: 3
    maxLength: 255
    title: Username
    description: Admin username for the machine. If using 'opc' the autogenerated password will be reset to the value below.

  instance_password:
    type: password
    required: true
    title: Password
    pattern: "^(?:(?=.*[a-z])(?:(?=.*[A-Z])(?=.*[\\d\\W])|(?=.*\\W)(?=.*\\d))|(?=.*\\W)(?=.*[A-Z])(?=.*\\d)).{12,}$"
    description: Password for admin user. 12 characters, contains 3 of lower case, uppercase, number, symbol

  #Orchestrator Info variables
  orchestratorVersion:
    type: enum
    required: true
    title: The version of Orchestrator to be deployed
    description: Orchestrator version
    default: "20.4.5"
    enum:
    - "20.4.5"
    - "19.10.19"


  orchestratorAdminPassword:
    type: password
    required: true
    title: Orchestrator admin's password
    pattern: "^(?:(?=[a-z])|(?=\\S*?[0-9])).{8,}$"
    description: The admin's password of Orchestrator. 8 characters long, must have at least one lowercase character and at least one digit.

  passphrase:
    type: password
    required: true
    title: Passphrase
    description: Passphrase is used to generate same AppEncryption key, Nuget API keys, Machine Validation and Decryption keys
    pattern: "^(?:(?=.*[a-z])(?:(?=.*[A-Z])(?=.*[\\d\\W])|(?=.*\\W)(?=.*\\d))|(?=.*\\W)(?=.*[A-Z])(?=.*\\d)).{12,}$"

  certificateBase64:
    type: string
    required: false
    title: Orchestrator's SSL certificate (base64)
    description: Apply your own SSL certificate to Orchestrator. If none is provided, the deployment will generate a self-signed certificate.
    visible: true

  certificatePass:
    type: string
    required: false
    title: SSL certificate password
    description: The password used to secure your PFX certificate

  ISCertificateBase64:
    type: string
    required: false
    title: Identity Server's certificate (base64)
    description: Apply your own certificate to Identy Server. If none is provided, the deployment will generate a self-signed certificate.
    visible: true

  ISCertificatePass:
    type: string
    required: false
    title: Identity Server's certificate password
    description: The password used to secure your PFX certificate

  #Virtual Machine Settings variables
  availability_domain_name:
    type: oci:identity:availabilitydomain:name
    dependsOn:
      compartmentId: compartment_ocid
    required: true
    title: Availability Domain
    description: Availability Domain

  vm_compute_shape:
    type: oci:core:instanceshape:name
    title: Compute Shape
    required: true
    default: "VM.Standard2.4"
    dependsOn:
      compartmentId: compartment_ocid
      imageId: mp_listing_resource_id

  # SQL Settings
  databaseType:
    type: enum
    required: true
    title: Type of database for Orchestrator
    description: Different options require different settings, existing option requires instance/user/pw to exist, paid option incurs a license charge
    default: "New SQL Server Evaluation"
    enum:
      - "New SQL Server Evaluation"
      - "Existing SQL Server"
      - "New Paid SQL Server Standard"

  ssh_public_key:
    type: oci:core:ssh:publickey
    required: true
    default: "<your key>"
    title: SSH Public Key
    description: Used only for SQL Server Evaluation running on Oracle Linux instance
    visible:
      eq:
        - ${databaseType}
        - "New SQL Server Evaluation"

  databaseServerName:
    type: string
    required: true
    default: "sqlserver2.domain.com"
    title: SQL Server Name (FQDN)
    description: SQL Server that will host Orchestrator database
    visible:
      eq:
        - ${databaseType}
        - "Existing SQL Server"

  databaseName:
    type: string
    required: true
    default: "uipath"
    title: SQL Database Name
    description: An empty pre-existing SQL Database needs to be available
    visible:
      eq:
        - ${databaseType}
        - "Existing SQL Server"

  databaseUserName:
    type: string
    required: true
    default: SA
    title: Admin account of SQL Server
    description: The admin account used by Orchestrator to connect to the database
    visible:
      eq:
        - ${databaseType}
        - "Existing SQL Server"

  databaseUserPassword:
    type: password
    required: true
    title: SQL Server admin's password
    description: The password of SQL Server's admin, 8 characters min, contains 3 of lower case, uppercase, number, symbol
    pattern: "^(?:(?=.*[a-z])(?:(?=.*[A-Z])(?=.*[\\d\\W])|(?=.*\\W)(?=.*\\d))|(?=.*\\W)(?=.*[A-Z])(?=.*\\d)).{8,}$"

  # Network Settings
  network_strategy:
    type: enum
    title: Network Strategy
    description: Create or use existing Network Stack (VCN and Subnet)
    default: "Create New VCN and Subnet"
    enum:
    - "Create New VCN and Subnet"
    - "Use Existing VCN and Subnet"
    required: true

  # subnet_type:
  #   visible: #($network_strategy  == ""Create New VCN and Subnet"")
  #     eq:
  #       - network_strategy
  #       - Create New VCN and Subnet
  #   type: enum
  #   title: Subnet Type
  #   description: Choose between private and public subnets
  #   enum:
  #   - "Private Subnet"
  #   - "Public Subnet"
  #   required: false

  vcn_display_name:
    visible: #($network_strategy  == ""Create New VCN and Subnet"")
      eq:
        - network_strategy
        - Create New VCN and Subnet
    type: string
    required: true
    default: "uipath"
    title: Virtual Cloud Network (VCN)
    description: The name of the new Virtual Cloud Network (VCN)

  vcn_id:
    visible: #($network_strategy  == "Use Existing VCN and Subnet")
      eq:
        - network_strategy
        - Use Existing VCN and Subnet
    type: oci:core:vcn:id
    dependsOn:
      compartmentId: compartment_ocid
    required: true
    default: ''
    title: Existing Network
    description: An existing Virtual Cloud Network (VCN) in which to create the compute instances, network resources, and load balancers. If not specified, a new VCN is created.

  vcn_cidr_block:
    visible: #($network_strategy  == ""Create New VCN and Subnet"")
      eq:
        - network_strategy
        - Create New VCN and Subnet
    type: string
    required: true
    default: "10.0.0.0/16"
    pattern: "^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\\/(3[0-2]|[1-2]?[0-9])$"
    title: VCN CIDR BLOCK
    description: The CIDR of the new Virtual Cloud Network (VCN). If you plan to peer this VCN with another VCN, the VCNs must not have overlapping CIDRs.

  subnet_display_name:
    visible: #($network_strategy  == ""Create New VCN and Subnet"")
      eq:
        - network_strategy
        - Create New VCN and Subnet
    type: string
    default: "subnet"
    required: false
    title: Subnet
    description: The name of the new Subnet

  subnet_cidr_block:
    visible: #($network_strategy  == ""Create New VCN and Subnet"")
      eq:
        - network_strategy
        - Create New VCN and Subnet
    type: string
    default: "10.0.0.0/24"
    pattern: "^(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9]).(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\\/(3[0-2]|[1-2]?[0-9])$"
    required: false
    title: Subnet CIDR
    description: The CIDR of the new Subnet. The new subnet's CIDR should not overlap with any other subnet CIDRs.

  subnet_id:
    visible: #($network_strategy  == "Use Existing VCN and Subnet")
      eq:
        - network_strategy
        - Use Existing VCN and Subnet
    type: oci:core:subnet:id
    dependsOn:
      vcnId: vcn_id
      compartmentId: compartment_ocid
    required: true
    default: ''
    title: Existing Subnet
    description: An existing subnet to use for compute instances. This subnet must already be present in the chosen VCN.

  subnet_dns_label:
    visible: #($network_strategy  == ""Create New VCN and Subnet"")
      eq:
        - network_strategy
        - Create New VCN and Subnet
    type: string
    required: true
    maxLength: 15
    default: "subnet"
    title: Subnet DNS Label
    description: Subnet DNS Label. Only letters and numbers, starting with a letter. 15 characters max.

  vcn_dns_label:
    visible: #($network_strategy  == ""Create New VCN and Subnet"")
      eq:
        - network_strategy
        - Create New VCN and Subnet
    type: string
    default: "uipath"
    required: true
    maxLength: 15
    title: VCN DNS Label
    description: VCN DNS Label. Only letters and numbers, starting with a letter. 15 characters max.

  nsg_display_name:
    type: string
    required: true
    default: my-network-security-group
    title: Network Security Group
    description: The name of the Network Security Group

  nsg_whitelist_ip:
    type: string
    required: true
    default: 0.0.0.0/0
    title: Network Security Groups - Whitelisted IP
    description: "Ingress connection to VM whitelisted from IP (range). Enter 0.0.0.0/0 or <your IP>/32"


outputGroups:
  - title: "Output"
    outputs:
      - instance_public_ip
      - instance_id

outputs:
  application_url:
    type: link
    title: Go to Application VM URL
    visible: false

  instance_public_ip:
    type: link
    title: Public IP
    visible: true

  instance_private_ip:
    type: link
    title: Private IP
    visible: true

primaryOutputButton: application_url
